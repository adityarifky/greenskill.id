{
  "entities": {
    "RegistrationSchema": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RegistrationSchema",
      "type": "object",
      "description": "Represents a training schema with its details.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Registration Schema entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the training schema."
        },
        "unitName": {
          "type": "string",
          "description": "Name of the training unit."
        },
        "unitCode": {
          "type": "string",
          "description": "Code representing the training unit."
        },
        "price": {
          "type": "number",
          "description": "Price of the training schema."
        }
      },
      "required": [
        "id",
        "name",
        "unitName",
        "unitCode",
        "price"
      ]
    },
    "TrainingOffer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TrainingOffer",
      "type": "object",
      "description": "Represents a training offer linked to a registration schema and user request.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Training Offer entity."
        },
        "registrationSchemaId": {
          "type": "string",
          "description": "Reference to RegistrationSchema. (Relationship: RegistrationSchema 1:N TrainingOffer)"
        },
        "customerName": {
            "type": "string",
            "description": "Name of the customer for the training offer."
        },
        "offerDate": {
            "type": "string",
            "format": "date",
            "description": "Date of the training offer."
        },
        "userRequest": {
          "type": "string",
          "description": "User's specific request for the training."
        },
        "dateCreated": {
          "type": "string",
          "description": "Date when the training offer was created.",
          "format": "date-time"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N TrainingOffer)"
        }
      },
      "required": [
        "id",
        "registrationSchemaId",
        "customerName",
        "offerDate",
        "userRequest",
        "dateCreated",
        "userId"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "Name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
     "OfferTemplate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OfferTemplate",
      "type": "object",
      "description": "Represents a user-defined template for training offers.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Offer Template entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the template."
        },
        "backgroundUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL of the background image for the template."
        },
        "parameters": {
          "type": "array",
          "description": "Array of parameter objects with their positions and labels.",
          "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "label": {"type": "string"},
              "key": {"type": "string"},
              "position": {
                "type": "object",
                "properties": {
                  "x": {"type": "number"},
                  "y": {"type": "number"}
                },
                "required": ["x", "y"]
              }
            },
            "required": ["id", "label", "key", "position"]
          }
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N OfferTemplate)"
        },
        "createdAt": {
            "type": "string",
            "description": "Date when the template was created.",
            "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "backgroundUrl",
        "parameters",
        "userId",
        "createdAt"
      ]
    },
    "Module": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Module",
        "type": "object",
        "description": "Represents a training module with a title and content.",
        "properties": {
            "id": {
                "type": "string",
                "description": "Unique identifier for the Module entity."
            },
            "title": {
                "type": "string",
                "description": "The title of the module."
            },
            "content": {
                "type": "string",
                "description": "The content of the module, can be plain text or markdown."
            },
            "userId": {
                "type": "string",
                "description": "Reference to User. (Relationship: User 1:N Module)"
            },
            "createdAt": {
                "type": "string",
                "description": "Date when the module was created.",
                "format": "date-time"
            },
            "updatedAt": {
                "type": "string",
                "description": "Date when the module was last updated.",
                "format": "date-time"
            }
        },
        "required": [
            "id",
            "title",
            "content",
            "userId",
            "createdAt",
            "updatedAt"
        ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/registration_schemas/{registrationSchemaId}",
        "definition": {
          "entityName": "RegistrationSchema",
          "schema": {
            "$ref": "#/backend/entities/RegistrationSchema"
          },
          "description": "Stores registration schemas. No denormalized authorization fields are needed as these schemas are assumed to be managed by admins (whose roles would be checked via DBAC).",
          "params": [
            {
              "name": "registrationSchemaId",
              "description": "Unique identifier for the registration schema."
            }
          ]
        }
      },
      {
        "path": "/training_offers/{trainingOfferId}",
        "definition": {
          "entityName": "TrainingOffer",
          "schema": {
            "$ref": "#/backend/entities/TrainingOffer"
          },
          "description": "Stores training offers. Includes denormalized 'userId' for authorization independence.  Allows listing and filtering training offers based on user ownership.",
          "params": [
            {
              "name": "trainingOfferId",
              "description": "Unique identifier for the training offer."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user data. Path-based ownership ensures only the user can access their own data.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/offer_templates/{templateId}",
        "definition": {
          "entityName": "OfferTemplate",
          "schema": {
            "$ref": "#/backend/entities/OfferTemplate"
          },
          "description": "Stores user-created offer templates, including parameter layouts. The 'userId' field ensures users can only access their own templates.",
          "params": [
            {
              "name": "templateId",
              "description": "Unique identifier for the offer template."
            }
          ]
        }
      },
       {
        "path": "/modules/{moduleId}",
        "definition": {
          "entityName": "Module",
          "schema": {
            "$ref": "#/backend/entities/Module"
          },
          "description": "Stores training modules. The 'userId' field ensures users can only access their own modules.",
          "params": [
            {
              "name": "moduleId",
              "description": "Unique identifier for the module."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the application's core features while adhering to the principles of Authorization Independence, Clarity of Intent, and DBAC (Database-Based Access Control). It focuses on storing registration schemas, training offers, user data, and user-defined templates in a structured and secure manner.\n\n*   **Authorization Independence:**  The `TrainingOffer` and `OfferTemplate` collections include the `userId` field, denormalizing user information for authorization purposes. This avoids the need for `get()` calls to the `/users/{userId}` document to verify ownership, thus ensuring atomic operations and simplifying security rules.\n*   **Structural Segregation:** Each entity type is stored in its own dedicated collection, ensuring a homogeneous security posture.\n*   **Access Modeling:** User data is stored using path-based ownership (`/users/{userId}`), granting each user exclusive access to their own data. Training offers and offer templates are also linked to a specific user through the `userId` field, enabling secure listing and filtering based on user-ownership.\n*   **QAPs (Rules are not Filters):** Listing operations are secured by segregating data into separate collections based on type and ownership, and by including the `userId` in the training offers and templates, which allows restricting access to user-specific content."
  }
}
